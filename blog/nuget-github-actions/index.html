<!doctype html><html lang=en-gb><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Publishing NuGet packages with GitHub Actions - TehGM's Blog</title><meta name=Description content="It's time to stop publishing NuGet packages manually - learn how to automate NuGet packages publishing with GitHub Actions!"><meta property="og:title" content="Publishing NuGet packages with GitHub Actions"><meta property="og:description" content="It's time to stop publishing NuGet packages manually - learn how to automate NuGet packages publishing with GitHub Actions!"><meta property="og:type" content="article"><meta property="og:url" content="https://tehgm.net/blog/nuget-github-actions/"><meta property="og:image" content="https://tehgm.net/img/tehgm_avatar.png"><meta property="article:published_time" content="2021-01-09T21:54:23+01:00"><meta property="article:modified_time" content="2021-01-09T21:54:23+01:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://tehgm.net/img/tehgm_avatar.png"><meta name=twitter:title content="Publishing NuGet packages with GitHub Actions"><meta name=twitter:description content="It's time to stop publishing NuGet packages manually - learn how to automate NuGet packages publishing with GitHub Actions!"><meta name=application-name content="TehGM"><meta name=apple-mobile-web-app-title content="TehGM"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://tehgm.net/blog/nuget-github-actions/><link rel=prev href=https://tehgm.net/blog/docfx-github-actions/><link rel=next href=https://tehgm.net/blog/aspnetcore-sass-js-minify/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Publishing NuGet packages with GitHub Actions","inLanguage":"en-gb","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/tehgm.net\/blog\/nuget-github-actions\/"},"image":["https:\/\/tehgm.net\/img\/tehgm_avatar.png"],"genre":"blog","keywords":"guide, dev","wordcount":2371,"url":"https:\/\/tehgm.net\/blog\/nuget-github-actions\/","datePublished":"2021-01-09T21:54:23+01:00","dateModified":"2021-01-09T21:54:23+01:00","publisher":{"@type":"Organization","name":"TehGM"},"author":{"@type":"Person","name":"TehGM"},"description":"It's time to stop publishing NuGet packages manually - learn how to automate NuGet packages publishing with GitHub Actions!"}</script></head><body header-desktop header-mobile><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('dark'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'dark'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=TehGM><span id=id-1 class=typeit></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/ title=Home>Home </a><a class=menu-item href=/blog/ title=Blog>Blog </a><a class=menu-item href=/blog/imo/ title="Blog: IMO">IMO </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=TehGM><span id=id-2 class=typeit></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/ title=Home>Home</a><a class=menu-item href=/blog/ title=Blog>Blog</a><a class=menu-item href=/blog/imo/ title="Blog: IMO">IMO</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class="toc-content always-active" id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">Publishing NuGet packages with GitHub Actions</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://tehgm.net title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>TehGM</a></span>&nbsp;<span class=post-category>included in <a href=/blog/categories/technology/><i class="far fa-folder fa-fw"></i>Technology</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=09.01.2021>09.01.2021</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;2371 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;12 minutes&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#what-is-nuget>What is NuGet?</a></li><li><a href=#what-are-github-actions>What are GitHub Actions</a></li><li><a href=#creating-a-nuget-action>Creating a NuGet Action</a><ul><li><a href=#requirements>Requirements</a></li><li><a href=#creating-auth-token>Creating auth token</a></li><li><a href=#creating-an-action-file>Creating an Action file</a></li><li><a href=#testing-the-action>Testing the action</a></li></ul></li><li><a href=#summary>Summary</a></li></ul></nav></div></div><div class=content id=content><p>Recently I wrote a post on <a href=https://tehgm.net/blog/docfx-github-actions/ rel>automating DocFX with GitHub Actions</a>. Now it&rsquo;s time to use similar automation to publish NuGet packages!</p><h2 id=what-is-nuget>What is NuGet?</h2><p><a href=https://docs.microsoft.com/en-gb/nuget/what-is-nuget target=_blank rel="noopener noreffer">NuGet</a> is a package manager for .NET. It allows to easily resolve dependencies in your .NET projects, manage their versions and so on, reducing the dependency hell when compared to manually managing DLL files.</p><p>The main way to share NuGet packages is <a href=https://www.nuget.org target=_blank rel="noopener noreffer">nuget.org NuGet Gallery</a>, which is maintained by Microsoft. This however isn&rsquo;t the only NuGet repository out there. There are many other repositories such as <a href=https://github.com/features/packages target=_blank rel="noopener noreffer">GitHub Packages</a> or <a href=https://www.myget.org/ target=_blank rel="noopener noreffer">MyGet</a>, and you can even set up a local folder as a repository and store your packages there!</p><h2 id=what-are-github-actions>What are GitHub Actions</h2><p><a href=https://github.com/features/actions target=_blank rel="noopener noreffer">GitHub Actions</a> are CI/CD workflows that are integrated directly into your GitHub repository. They can be ran manually or automatically on certain events (such as push to a branch or a Pull Request being opened). If Action is triggered by a Pull Request, GitHub will automatically start the action, and will prevent merging the PR until all actions are successful (unless you&rsquo;re an admin on the repository - then you can force merge).</p><p>GitHub Actions are free to use for public repositiories.</p><h2 id=creating-a-nuget-action>Creating a NuGet Action</h2><p>There&rsquo;s an existing <a href=https://github.com/marketplace/actions/publish-nuget target=_blank rel="noopener noreffer">publish-nuget</a> by <em><a href=https://github.com/rohith target=_blank rel="noopener noreffer">rohith</a></em>, but after looking at its source code, I had an impression that this action would only work with nuget.org. For this reason, I&rsquo;ll explain how to build an action that is repository-independent.</p><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fas fa-info-circle fa-fw"></i>Info<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>In this blog post I am focusing on using nuget.org because it&rsquo;s the main repository, but you can use this set up to publish your packages to any other source - simply specify <code>--source &lt;your-source></code> argument in your push command!</div></div></div><h3 id=requirements>Requirements</h3><p>I assume that you already have your project code ready and in a github repository. I also assume that you have an account in your chosen repository if it requires it - nuget.org does!</p><h3 id=creating-auth-token>Creating auth token</h3><p>NuGet repositories usually require an authentication token to publish. And that&rsquo;s good - we don&rsquo;t want everyone to be able to publish our packages updates, that&rsquo;d cause chaos!<br>So, let&rsquo;s create the token and add it to our repository so our GitHub Action can use it.</p><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw"></i>GitHub Packages<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>When using <a href=https://github.com/features/packages target=_blank rel="noopener noreffer">GitHub Packages</a> as your NuGet repository, you don&rsquo;t need to do this - go to <a href=#creating-an-action-file rel>Creating an Action file</a>, and simply replace any <code>${{secrets.NUGET_TOKEN}}</code> with <code>${{secrets.GITHUB_TOKEN}}</code>.</div></div></div><h4 id=creating-token-on-nugetorg>Creating token on nuget.org</h4><p>To create a token on nuget.org, first <a href=https://www.nuget.org/users/account/LogOn target=_blank rel="noopener noreffer">login</a> to your account. When logged in, go to <a href=https://www.nuget.org/account/apikeys target=_blank rel="noopener noreffer">API Keys</a> and click <em>Create</em>. Here you will need to input key name and select packages (you can use glob pattern). When all data provided, press blue &ldquo;<em>Create</em>&rdquo; button.
<a class=lightgallery href=/blog/nuget-github-actions/screenshot-creating-token-1.png title=/blog/nuget-github-actions/screenshot-creating-token-1.png data-thumbnail=/blog/nuget-github-actions/screenshot-creating-token-1.png><img class=lazyload src=/svg/loading.min.svg data-src=screenshot-creating-token-1.png data-srcset="/blog/nuget-github-actions/screenshot-creating-token-1.png, screenshot-creating-token-1.png 1.5x, /blog/nuget-github-actions/screenshot-creating-token-1.png 2x" data-sizes=auto alt=/blog/nuget-github-actions/screenshot-creating-token-1.png></a></p><p>Once created, you need to copy the new token. Keep it somewhere safe for the time being - we&rsquo;ll need to add it to our repository in a moment!
<a class=lightgallery href=/blog/nuget-github-actions/screenshot-creating-token-2.png title=/blog/nuget-github-actions/screenshot-creating-token-2.png data-thumbnail=/blog/nuget-github-actions/screenshot-creating-token-2.png><img class=lazyload src=/svg/loading.min.svg data-src=screenshot-creating-token-2.png data-srcset="/blog/nuget-github-actions/screenshot-creating-token-2.png, screenshot-creating-token-2.png 1.5x, /blog/nuget-github-actions/screenshot-creating-token-2.png 2x" data-sizes=auto alt=/blog/nuget-github-actions/screenshot-creating-token-2.png></a></p><h4 id=adding-token-to-github>Adding Token to GitHub</h4><p>GitHub repositories can store <a href=https://docs.github.com/en/free-pro-team@latest/actions/reference/encrypted-secrets target=_blank rel="noopener noreffer">secrets</a>. These secrets are stored in a secure manner - no one is able to see them, and they&rsquo;re injected into Actions only when they&rsquo;re being executed. This is the perfect place for our nuget.org auth token.<br>Go to your repository <em>Settings</em>, then <em>Secrets</em>. To add a new secret, press &ldquo;<em>New repository secret</em>&rdquo; button.
<a class=lightgallery href=/blog/nuget-github-actions/screenshot-creating-token-3.png title=/blog/nuget-github-actions/screenshot-creating-token-3.png data-thumbnail=/blog/nuget-github-actions/screenshot-creating-token-3.png><img class=lazyload src=/svg/loading.min.svg data-src=screenshot-creating-token-3.png data-srcset="/blog/nuget-github-actions/screenshot-creating-token-3.png, screenshot-creating-token-3.png 1.5x, /blog/nuget-github-actions/screenshot-creating-token-3.png 2x" data-sizes=auto alt=/blog/nuget-github-actions/screenshot-creating-token-3.png></a></p><p>On the page that opens, type in the name of the secret - we&rsquo;ll use <code>NUGET_TOKEN</code> in this guide. In Value field, paste the token you copied from nuget.org. Once done, press &ldquo;<em>Add secret</em>&rdquo;.
<a class=lightgallery href=/blog/nuget-github-actions/screenshot-creating-token-4.png title=/blog/nuget-github-actions/screenshot-creating-token-4.png data-thumbnail=/blog/nuget-github-actions/screenshot-creating-token-4.png><img class=lazyload src=/svg/loading.min.svg data-src=screenshot-creating-token-4.png data-srcset="/blog/nuget-github-actions/screenshot-creating-token-4.png, screenshot-creating-token-4.png 1.5x, /blog/nuget-github-actions/screenshot-creating-token-4.png 2x" data-sizes=auto alt=/blog/nuget-github-actions/screenshot-creating-token-4.png></a></p><div class="details admonition tip open"><div class="details-summary admonition-title"><i class="icon fas fa-lightbulb fa-fw"></i>Tip<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>The token from nuget.org expires after maximum of 1 year. Once you regenerate the token on nuget.org, you can update it on your repository secrets page by pressing &ldquo;<em>Update</em>&rdquo; button next to your secret.</div></div></div><h3 id=creating-an-action-file>Creating an Action file</h3><p>Actions are configured as .yml files, and reside in <code>.github/workflows/</code> directory in your repository. You can create the file manually, but let&rsquo;s use GitHub menus to create the file in a correct location for us. In your repository, press <strong>Actions</strong> button. GitHub automatically suggests some pre-defined Actions templates, but for this tutorial, let&rsquo;s click <em>set up a workflow yourself</em> link.</p><a class=lightgallery href=/blog/nuget-github-actions/screenshot-creating-action-1.png title=/blog/nuget-github-actions/screenshot-creating-action-1.png data-thumbnail=/blog/nuget-github-actions/screenshot-creating-action-1.png><img class=lazyload src=/svg/loading.min.svg data-src=screenshot-creating-action-1.png data-srcset="/blog/nuget-github-actions/screenshot-creating-action-1.png, screenshot-creating-action-1.png 1.5x, /blog/nuget-github-actions/screenshot-creating-action-1.png 2x" data-sizes=auto alt=/blog/nuget-github-actions/screenshot-creating-action-1.png></a><p>GitHub will display a template for a default workflow - you are welcome to edit it, or remove everything and start fresh.</p><h4 id=naming-your-action>Naming your action</h4><p>Your action needs a name - you can name it whatever you want, but I suggest using a name that will help you understand what the action does just from the name alone.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>name</span><span class=p>:</span><span class=w> </span>NuGet<span class=w> </span>Publish</code></pre></td></tr></table></div></div><p>You probably want to rename the .yml file as well:
<a class=lightgallery href=/blog/nuget-github-actions/screenshot-naming-action-1.png title=/blog/nuget-github-actions/screenshot-naming-action-1.png data-thumbnail=/blog/nuget-github-actions/screenshot-naming-action-1.png><img class=lazyload src=/svg/loading.min.svg data-src=screenshot-naming-action-1.png data-srcset="/blog/nuget-github-actions/screenshot-naming-action-1.png, screenshot-naming-action-1.png 1.5x, /blog/nuget-github-actions/screenshot-naming-action-1.png 2x" data-sizes=auto alt=/blog/nuget-github-actions/screenshot-naming-action-1.png></a></p><h4 id=selecting-when-to-run>Selecting when to run</h4><p>Actions can be triggered by numerous events, but for this action, I&rsquo;ll make it runnable only manually, through <strong>Actions</strong> tab.<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>on</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>workflow_dispatch<span class=p>:</span></code></pre></td></tr></table></div></div></p><p>Of course you can use any event you want - see <a href=https://docs.github.com/en/free-pro-team@latest/actions/reference/events-that-trigger-workflows target=_blank rel="noopener noreffer">Events that Trigger Workflows</a> for a list.</p><h4 id=creating-a-job>Creating a job</h4><p>GitHub Actions can have multiple <a href=https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions#jobs target=_blank rel="noopener noreffer">jobs</a> running in parallel, or one after another if you use <a href=https://docs.github.com/en/free-pro-team@latest/actions/reference/workflow-syntax-for-github-actions#jobsjob_idneeds target=_blank rel="noopener noreffer">needs</a> option. For our example, we&rsquo;ll use just one job - let&rsquo;s name it <code>nuget-publish</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>jobs</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>nuget-publish</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>runs-on</span><span class=p>:</span><span class=w> </span>ubuntu-latest</code></pre></td></tr></table></div></div><h4 id=steps>Steps</h4><p>GitHub Action job runs in steps, which always run one after another. This way, we can get everything installed etc before we build the package and publish it.<br>All steps should be inside of our job object.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=hl><span class=lnt>10
</span></span><span class=hl><span class=lnt>11
</span></span></code></pre></td><td class=lntd><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>jobs</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>nuget-publish</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>runs-on</span><span class=p>:</span><span class=w> </span>ubuntu-latest<span class=w>
</span><span class=w>
</span><span class=hl><span class=w>    </span><span class=k>steps</span><span class=p>:</span><span class=w>
</span></span><span class=hl><span class=w>      </span><span class=c># all steps go here</span></span></code></pre></td></tr></table></div></div><h5 id=step-1---checkout>Step 1 - Checkout</h5><p>The first step is to get all of our project code onto virtual machine. This is easy to do using predefined <a href=https://github.com/actions/checkout target=_blank rel="noopener noreffer">checkout action</a>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>10
</span><span class=hl><span class=lnt>11
</span></span><span class=hl><span class=lnt>12
</span></span></code></pre></td><td class=lntd><pre class=chroma><code class=language-yaml data-lang=yaml><span class=w>    </span><span class=k>steps</span><span class=p>:</span><span class=w>
</span><span class=hl><span class=w>      </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>Checkout<span class=w>
</span></span><span class=hl><span class=w>        </span><span class=k>uses</span><span class=p>:</span><span class=w> </span>actions/checkout@v2</span></code></pre></td></tr></table></div></div><h5 id=step-2---install-net-core>Step 2 - Install .NET Core</h5><p>The 2nd step is to install .NET Core. Luckily there is already a predefined action for that called <a href=https://github.com/actions/setup-dotnet target=_blank rel="noopener noreffer">setup-dotnet</a>, so we don&rsquo;t have to run series of commands.<br>In this action we also set nuget source and auth token we created <a href=#creating-auth-token rel>just before</a> starting to create our action. This is important, as without it GitHub Actions will complain. We can override them later on a per-push basis if needed.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-yaml data-lang=yaml><span class=w>      </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>Setup<span class=w> </span>.NET<span class=w> </span>Core<span class=w>
</span><span class=w>        </span><span class=k>uses</span><span class=p>:</span><span class=w> </span>actions/setup-dotnet@v1<span class=w>
</span><span class=w>        </span><span class=k>with</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=k>source-url</span><span class=p>:</span><span class=w> </span>https<span class=p>:</span>//api.nuget.org/v3/index.json<span class=w>
</span><span class=w>          </span><span class=k>dotnet-version</span><span class=p>:</span><span class=w> </span><span class=m>3.1.101</span><span class=w>
</span><span class=w>        </span><span class=k>env</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=k>NUGET_AUTH_TOKEN</span><span class=p>:</span><span class=w> </span>${{secrets.NUGET_TOKEN}}</code></pre></td></tr></table></div></div><div class="details admonition tip open"><div class="details-summary admonition-title"><i class="icon fas fa-lightbulb fa-fw"></i>GitHub Packages<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>If you&rsquo;re publishing to GitHub Packages, use <code>secrets.GITHUB_TOKEN</code> instead.</div></div></div><h5 id=step-3---install-dependencies>Step 3 - Install dependencies</h5><p>Now with .NET Core installed, let&rsquo;s run a command to restore the dependencies that your package has. This is optional if you pack the package without <a href=https://docs.microsoft.com/pl-pl/dotnet/core/tools/dotnet-pack#implicit-restore target=_blank rel="noopener noreffer"><code>--no-restore</code></a> flag, but it is recommended to include this flag in CI/CD workflows.
To install dependencies, we simply run <code>dotnet restore</code> command in the step:<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-yaml data-lang=yaml><span class=w>      </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>Install<span class=w> </span>dependencies<span class=w>
</span><span class=w>        </span><span class=k>run</span><span class=p>:</span><span class=w> </span>dotnet<span class=w> </span>restore</code></pre></td></tr></table></div></div></p><h5 id=step-4---publish-the-package>Step 4 - Publish the package</h5><p>Now we just have to actually pack and publish the package. To do so, we run a few commands:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-yaml data-lang=yaml><span class=w>      </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>Publish<span class=w>
</span><span class=w>        </span><span class=k>run</span><span class=p>:</span><span class=w> </span>|<span class=w> </span><span class=c># | character makes the &#34;run&#34; property multi-line, so we can put multiple commands in the same step</span><span class=w>
</span><span class=w>          </span>mkdir<span class=w> </span>__out<span class=w>
</span><span class=w>          </span>dotnet<span class=w> </span>pack<span class=w> </span>-c<span class=w> </span>Release<span class=w> </span>-o<span class=w> </span>__out<span class=w> </span>--no-restore<span class=w>
</span><span class=w>          </span>dotnet<span class=w> </span>nuget<span class=w> </span>push<span class=w> </span><span class=s2>&#34;./__out/*.nupkg&#34;</span><span class=w> </span>--skip-duplicate<span class=w> </span>--no-symbols<span class=w> </span><span class=kc>true</span><span class=w> </span>--api-key<span class=w> </span>${{secrets.NUGET_TOKEN}}<span class=w>
</span><span class=w>          </span>rm<span class=w> </span>-rf<span class=w> </span>__out</code></pre></td></tr></table></div></div><p>Whoa, so there&rsquo;s a lot to unpack (no pun intended!) here. Let me explain each of these commands.</p><ul><li><code>mkdir __out</code> command creates a temporary &ldquo;<em>__out</em>&rdquo; folder. This isn&rsquo;t really a requirement, but it helps with keeping everything categorized, knowing where the packages go, and lets us clean up - which will be important if you want to use your action to <a href=#selecting-projects-to-publish rel>publish multiple packages</a>.</li><li><code>dotnet pack</code> command builds our solution and creates a package for each project. <code>-c Release</code> tells .NET compiler to use Release configuration. <code>-o __out</code> causes the packages to land in &ldquo;<em>__out</em>&rdquo; folder. <code>--no-restore</code> skips restoring packages because we already did that in <a href=#step-3---install-dependencies rel>Step 3</a>.</li><li><code>dotnet nuget push</code> is where the publishing actually happens. The <code>"./__out/*.nupkg"</code> simply tells the command to publish each .nupkg file that currently exists in our &ldquo;<em>__out</em>&rdquo; folder. <code>--skip-duplicate</code> flag will cause the command to skip publishing if a package with the same name and version is already published, which will let us run the Action safely even if we already ran it for this package version. <code>--no-symbols true</code> will skip generating symbols files (.snupkg) - this is really important, cause if we don&rsquo;t skip and symbols don&rsquo;t get generated, removing &ldquo;<em>__out</em>&rdquo; folder will fail, making the Action fail as well. Lastly we pass in our <a href=#creating-auth-token rel>auth token</a> using <code>--api-key ${{secrets.NUGET_TOKEN}}</code> - for some reason this is required even though we already set it using in <a href=#step-2---install-net-core rel>Step 2</a>.</li><li><code>rm -rf __out</code> will remove the temporary &ldquo;<em>__out</em>&rdquo; folder and all of its contents.</li></ul><p><div class="details admonition tip open"><div class="details-summary admonition-title"><i class="icon fas fa-lightbulb fa-fw"></i>Changing repository<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>If you&rsquo;re publishing to a different repository than nuget.org, you can also add <code>--source &lt;url></code> to <code>dotnet nuget push</code> command.<br>Using that argument, you can also publish to multiple NuGet repositories at once - simply duplicate <code>dotnet nuget push</code> line, and use different source + api-key combo!</div></div></div><div class="details admonition not open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fw"></i>GitHub Packages<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>When you&rsquo;re using GitHub Packages as your NuGet repository, change <code>${{secrets.NUGET_TOKEN}}</code> to <code>${{secrets.GITHUB_TOKEN}}</code></div></div></div></p><h4 id=publishing-metapackages>Publishing Metapackages</h4><p>You can use this action to publish Metapackages (using .nuspec files), too - but the <a href=#step-4---publish-the-package rel>Publish Step</a> step will need a small change.</p><p>Replace <code>dotnet pack</code> command with <code>nuget pack</code> command:<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=hl><span class=lnt>25
</span></span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-yaml data-lang=yaml><span class=w>      </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>Publish<span class=w>
</span><span class=w>        </span><span class=k>run</span><span class=p>:</span><span class=w> </span><span class=sd>|
</span><span class=sd>          mkdir __out</span><span class=w>
</span><span class=hl><span class=w>          </span>nuget<span class=w> </span>pack<span class=w> </span><span class=s2>&#34;MetapackageFolder/Metapackage.nuspec&#34;</span><span class=w> </span>-Exclude<span class=w> </span><span class=s2>&#34;*.*&#34;</span><span class=w> </span>-BasePath<span class=w> </span><span class=s2>&#34;MetapackageFolder&#34;</span><span class=w> </span>-NonInteractive<span class=w> </span>-OutputDirectory<span class=w> </span>__out<span class=w>
</span></span><span class=w>          </span>dotnet<span class=w> </span>nuget<span class=w> </span>push<span class=w> </span><span class=s2>&#34;./__out/*.nupkg&#34;</span><span class=w> </span>--skip-duplicate<span class=w> </span>--no-symbols<span class=w> </span><span class=kc>true</span><span class=w> </span>--api-key<span class=w> </span>${{secrets.NUGET_TOKEN}}<span class=w>
</span><span class=w>          </span>rm<span class=w> </span>-rf<span class=w> </span>__out</code></pre></td></tr></table></div></div></p><ul><li><code>"MetapackageFolder/Metapackage.nuspec"</code> is the path to your .nuspec file - I tend to put them in a separate folder to avoid any issues when packing.</li><li><code>-Exclude "*.*"</code> excludes all files that might reside in the same folder as .nuspec file. If it&rsquo;s not a metapackage or otherwise undesired, simply remove that argument.</li><li><code>-BasePath "MetapackageFolder"</code> sets base path for the command to be the same as .nuspec file folder. Remove it if your .nuspec file isn&rsquo;t in a separate folder.</li><li><code>-NonInteractive</code> disables all prompts - we can&rsquo;t interact with them in GitHub Actions anyway, and they could halt the step!</li><li><code>-OutputDirectory __out</code> causes the package to land in &ldquo;<em>__out</em>&rdquo; folder.</li></ul><h4 id=the-action-so-far>The Action so far</h4><p>That was rather easy, don&rsquo;t you think? The action so far should look more or less like this:<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>name</span><span class=p>:</span><span class=w> </span>NuGet<span class=w> </span>Publish<span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>on</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>workflow_dispatch</span><span class=p>:</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>jobs</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>nuget-publish</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>runs-on</span><span class=p>:</span><span class=w> </span>ubuntu-latest<span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=k>steps</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>Checkout<span class=w>
</span><span class=w>        </span><span class=k>uses</span><span class=p>:</span><span class=w> </span>actions/checkout@v2<span class=w>
</span><span class=w>      </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>Setup<span class=w> </span>.NET<span class=w> </span>Core<span class=w>
</span><span class=w>        </span><span class=k>uses</span><span class=p>:</span><span class=w> </span>actions/setup-dotnet@v1<span class=w>
</span><span class=w>        </span><span class=k>with</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=k>source-url</span><span class=p>:</span><span class=w> </span>https<span class=p>:</span>//api.nuget.org/v3/index.json<span class=w>
</span><span class=w>          </span><span class=k>dotnet-version</span><span class=p>:</span><span class=w> </span><span class=m>3.1.101</span><span class=w>
</span><span class=w>        </span><span class=k>env</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=k>NUGET_AUTH_TOKEN</span><span class=p>:</span><span class=w> </span>${{secrets.NUGET_TOKEN}}<span class=w>
</span><span class=w>      </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>Install<span class=w> </span>dependencies<span class=w>
</span><span class=w>        </span><span class=k>run</span><span class=p>:</span><span class=w> </span>dotnet<span class=w> </span>restore<span class=w>
</span><span class=w>
</span><span class=w>      </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>Publish<span class=w>
</span><span class=w>        </span><span class=k>run</span><span class=p>:</span><span class=w> </span><span class=sd>|
</span><span class=sd>          mkdir __out</span><span class=w>
</span><span class=w>          </span>dotnet<span class=w> </span>pack<span class=w> </span>-c<span class=w> </span>Release<span class=w> </span>-o<span class=w> </span>__out<span class=w> </span>--no-restore<span class=w>
</span><span class=w>          </span>dotnet<span class=w> </span>nuget<span class=w> </span>push<span class=w> </span><span class=s2>&#34;./__out/*.nupkg&#34;</span><span class=w> </span>--skip-duplicate<span class=w> </span>--no-symbols<span class=w> </span><span class=kc>true</span><span class=w> </span>--api-key<span class=w> </span>${{secrets.NUGET_TOKEN}}<span class=w>
</span><span class=w>          </span>rm<span class=w> </span>-rf<span class=w> </span>__out</code></pre></td></tr></table></div></div></p><h4 id=selecting-projects-to-publish>Selecting Projects to Publish</h4><p>Now bear with me for a moment - this action will be good enough when you have only one project in your solution, or your solution has multiple projects but you want to publish them all. If that&rsquo;s the case, you can go to <a href=#saving-action rel>Saving Action</a> and enjoy your action now!<br>But in many cases, you don&rsquo;t want to publish all projects, or at the very least you want to control when to publish specific projects, so read on!</p><h5 id=excluding-projects-completely>Excluding Projects completely</h5><p>You can exclude projects completely by using <a href=https://docs.microsoft.com/en-gb/dotnet/core/tools/dotnet-sln#remove target=_blank rel="noopener noreffer"><code>dotnet sln remove</code></a> command. To do it, add a new step to your Action, preferably just before <a href=#step-3---install-dependencies rel>Step 3</a>. For example, my libraries tend to have &ldquo;Examples&rdquo; folder where example projects reside - I definitely don&rsquo;t need these to be published to NuGet!</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-yaml data-lang=yaml><span class=w>      </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>Exclude<span class=w> </span>example<span class=w> </span>projects<span class=w>
</span><span class=w>        </span><span class=k>run</span><span class=p>:</span><span class=w> </span>dotnet<span class=w> </span>sln<span class=w> </span>remove<span class=w> </span>Examples/<span class=cp>**</span></code></pre></td></tr></table></div></div><h5 id=manually-selecting-projects>Manually selecting projects</h5><p>Excluding projects completely is great and will fulfill most &ldquo;excluding needs&rdquo;, but we can go a step further - we can individually select the projects we want to publish. To do this, we&rsquo;ll use <a href=https://github.blog/changelog/2020-07-06-github-actions-manual-triggers-with-workflow_dispatch/ target=_blank rel="noopener noreffer">Manual triggers inputs</a> feature of GitHub Actions.</p><div class="details admonition danger open"><div class="details-summary admonition-title"><i class="icon fas fa-skull-crossbones fa-fw"></i>Danger<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content><a href=https://github.blog/changelog/2020-07-06-github-actions-manual-triggers-with-workflow_dispatch/ target=_blank rel="noopener noreffer">Manual triggers inputs</a> only work for actions that are triggered manually (on <code>workflow_dispatch</code>). If your action uses different trigger events (for example, on <code>push</code> or <code>pull_request</code>) this unfortunately is not a feature for you.</div></div></div><p>You need to add a separate input for each of your projects that you want to publish. Let&rsquo;s assume your solution has 2 projects: <code>MyLibrary</code> and <code>MyLibrary.ExtraStuff</code>. With these 2 libraries, you&rsquo;d modify the beginning of the action as follows:<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>on</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>workflow_dispatch</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>inputs</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=k>publishMain</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>description</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;Publish MyLibrary (Y/N)?&#39;</span><span class=w>
</span><span class=w>        </span><span class=k>required</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span><span class=w>        </span><span class=k>default</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;Y&#39;</span><span class=w> </span><span class=c># You can remove this line if you don&#39;t want to default to &#34;yes&#34;</span><span class=w>
</span><span class=w>      </span><span class=k>publishExtraStuff</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>description</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;Publish MyLibrary.ExtraStuff (Y/N)?&#39;</span><span class=w>
</span><span class=w>        </span><span class=k>required</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span><span class=w>        </span><span class=k>default</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;Y&#39;</span><span class=w> </span><span class=c># You can remove this line if you don&#39;t want to default to &#34;yes&#34;</span></code></pre></td></tr></table></div></div></p><p>Now we also need to modify 3 things in <a href=#step-4---publish-the-package rel>Step 4</a>: we need to change its name, specify the project in <code>dotnet pack</code> command, and add an <code>if</code> condition that will check whether the step should run.<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=hl><span class=lnt>31
</span></span><span class=hl><span class=lnt>32
</span></span><span class=lnt>33
</span><span class=lnt>34
</span><span class=hl><span class=lnt>35
</span></span><span class=lnt>36
</span><span class=lnt>37
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-yaml data-lang=yaml><span class=hl><span class=w>      </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>Publish<span class=w> </span>MyLibrary<span class=w>
</span></span><span class=hl><span class=w>        </span><span class=k>if</span><span class=p>:</span><span class=w> </span>github.event.inputs.publishMain<span class=w> </span>==<span class=w> </span><span class=s1>&#39;Y&#39;</span><span class=w>
</span></span><span class=w>        </span><span class=k>run</span><span class=p>:</span><span class=w> </span><span class=sd>|
</span><span class=sd>          mkdir __out</span><span class=w>
</span><span class=hl><span class=w>          </span>dotnet<span class=w> </span>pack<span class=w> </span>MyLibrary<span class=w> </span>-c<span class=w> </span>Release<span class=w> </span>-o<span class=w> </span>__out<span class=w> </span>--no-restore<span class=w>
</span></span><span class=w>          </span>dotnet<span class=w> </span>nuget<span class=w> </span>push<span class=w> </span><span class=s2>&#34;./__out/*.nupkg&#34;</span><span class=w> </span>--skip-duplicate<span class=w> </span>--no-symbols<span class=w> </span><span class=kc>true</span><span class=w> </span>--api-key<span class=w> </span>${{secrets.NUGET_TOKEN}}<span class=w>
</span><span class=w>          </span>rm<span class=w> </span>-rf<span class=w> </span>__out</code></pre></td></tr></table></div></div></p><p>Now just copy this updated step, and paste it right after - of course change name and <code>project pack</code> to &ldquo;<em>MyLibrary.ExtraStuff</em>&rdquo;, and name of the input check to <code>publishExtraStuff</code>.</p><h5 id=updated-action>Updated Action</h5><p>Let&rsquo;s revisit our complete Action. It should look more or less like this:<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>name</span><span class=p>:</span><span class=w> </span>NuGet<span class=w> </span>Publish<span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>on</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>workflow_dispatch</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>inputs</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=k>publishMain</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>description</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;Publish MyLibrary (Y/N)?&#39;</span><span class=w>
</span><span class=w>        </span><span class=k>required</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span><span class=w>        </span><span class=k>default</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;Y&#39;</span><span class=w>
</span><span class=w>      </span><span class=k>publishExtraStuff</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=k>description</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;Publish MyLibrary.ExtraStuff (Y/N)?&#39;</span><span class=w>
</span><span class=w>        </span><span class=k>required</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span><span class=w>        </span><span class=k>default</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;Y&#39;</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>jobs</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>nuget-publish</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>runs-on</span><span class=p>:</span><span class=w> </span>ubuntu-latest<span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=k>steps</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>Checkout<span class=w>
</span><span class=w>        </span><span class=k>uses</span><span class=p>:</span><span class=w> </span>actions/checkout@v2<span class=w>
</span><span class=w>      </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>Setup<span class=w> </span>.NET<span class=w> </span>Core<span class=w>
</span><span class=w>        </span><span class=k>uses</span><span class=p>:</span><span class=w> </span>actions/setup-dotnet@v1<span class=w>
</span><span class=w>        </span><span class=k>with</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=k>source-url</span><span class=p>:</span><span class=w> </span>https<span class=p>:</span>//api.nuget.org/v3/index.json<span class=w>
</span><span class=w>          </span><span class=k>dotnet-version</span><span class=p>:</span><span class=w> </span><span class=m>3.1.101</span><span class=w>
</span><span class=w>        </span><span class=k>env</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=k>NUGET_AUTH_TOKEN</span><span class=p>:</span><span class=w> </span>${{secrets.NUGET_TOKEN}}<span class=w>
</span><span class=w>      </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>Exclude<span class=w> </span>example<span class=w> </span>projects<span class=w>
</span><span class=w>        </span><span class=k>run</span><span class=p>:</span><span class=w> </span>dotnet<span class=w> </span>sln<span class=w> </span>remove<span class=w> </span>Examples/<span class=cp>**</span><span class=w>
</span><span class=w>      </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>Install<span class=w> </span>dependencies<span class=w>
</span><span class=w>        </span><span class=k>run</span><span class=p>:</span><span class=w> </span>dotnet<span class=w> </span>restore<span class=w>
</span><span class=w>
</span><span class=w>      </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>Publish<span class=w> </span>MyLibrary<span class=w>
</span><span class=w>        </span><span class=k>if</span><span class=p>:</span><span class=w> </span>github.event.inputs.publishMain<span class=w> </span>==<span class=w> </span><span class=s1>&#39;Y&#39;</span><span class=w>
</span><span class=w>        </span><span class=k>run</span><span class=p>:</span><span class=w> </span><span class=sd>|
</span><span class=sd>          mkdir __out</span><span class=w>
</span><span class=w>          </span>dotnet<span class=w> </span>pack<span class=w> </span>MyLibrary<span class=w> </span>-c<span class=w> </span>Release<span class=w> </span>-o<span class=w> </span>__out<span class=w> </span>--no-restore<span class=w>
</span><span class=w>          </span>dotnet<span class=w> </span>nuget<span class=w> </span>push<span class=w> </span><span class=s2>&#34;./__out/*.nupkg&#34;</span><span class=w> </span>--skip-duplicate<span class=w> </span>--no-symbols<span class=w> </span><span class=kc>true</span><span class=w> </span>--api-key<span class=w> </span>${{secrets.NUGET_TOKEN}}<span class=w>
</span><span class=w>          </span>rm<span class=w> </span>-rf<span class=w> </span>__out<span class=w>
</span><span class=w>      </span>- <span class=k>name</span><span class=p>:</span><span class=w> </span>Publish<span class=w> </span>MyLibrary.ExtraStuff<span class=w>
</span><span class=w>        </span><span class=k>if</span><span class=p>:</span><span class=w> </span>github.event.inputs.publishExtraStuff<span class=w> </span>==<span class=w> </span><span class=s1>&#39;Y&#39;</span><span class=w>
</span><span class=w>        </span><span class=k>run</span><span class=p>:</span><span class=w> </span><span class=sd>|
</span><span class=sd>          mkdir __out</span><span class=w>
</span><span class=w>          </span>dotnet<span class=w> </span>pack<span class=w> </span>MyLibrary.ExtraStuff<span class=w> </span>-c<span class=w> </span>Release<span class=w> </span>-o<span class=w> </span>__out<span class=w> </span>--no-restore<span class=w>
</span><span class=w>          </span>dotnet<span class=w> </span>nuget<span class=w> </span>push<span class=w> </span><span class=s2>&#34;./__out/*.nupkg&#34;</span><span class=w> </span>--skip-duplicate<span class=w> </span>--no-symbols<span class=w> </span><span class=kc>true</span><span class=w> </span>--api-key<span class=w> </span>${{secrets.NUGET_TOKEN}}<span class=w>
</span><span class=w>          </span>rm<span class=w> </span>-rf<span class=w> </span>__out</code></pre></td></tr></table></div></div></p><h4 id=saving-action>Saving Action</h4><p>You can go ahead, and press <strong>Start commit</strong>. You can name your commit, and select whether it should be commited directly to master, or started as a pull request.
<a class=lightgallery href=/blog/nuget-github-actions/screenshot-saving-action-1.png title=/blog/nuget-github-actions/screenshot-saving-action-1.png data-thumbnail=/blog/nuget-github-actions/screenshot-saving-action-1.png><img class=lazyload src=/svg/loading.min.svg data-src=screenshot-saving-action-1.png data-srcset="/blog/nuget-github-actions/screenshot-saving-action-1.png, screenshot-saving-action-1.png 1.5x, /blog/nuget-github-actions/screenshot-saving-action-1.png 2x" data-sizes=auto alt=/blog/nuget-github-actions/screenshot-saving-action-1.png></a></p><h3 id=testing-the-action>Testing the action</h3><p>Finally the time to test your action out! Go to <strong>Actions</strong> tab in your repository, and select your new <em>NuGet Publish</em> workflow. Then, press &ldquo;<em>Run workflow</em>&rdquo; button.<figure><a class=lightgallery href=/blog/nuget-github-actions/screenshot-running-action-1.png title=/blog/nuget-github-actions/screenshot-running-action-1.png data-thumbnail=/blog/nuget-github-actions/screenshot-running-action-1.png data-sub-html="<h2>Where to find &lsquo;Run workflow&rsquo; button</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=screenshot-running-action-1.png data-srcset="/blog/nuget-github-actions/screenshot-running-action-1.png, screenshot-running-action-1.png 1.5x, /blog/nuget-github-actions/screenshot-running-action-1.png 2x" data-sizes=auto alt=/blog/nuget-github-actions/screenshot-running-action-1.png></a><figcaption class=image-caption>Where to find &lsquo;<em>Run workflow</em>&rsquo; button</figcaption></figure></p><p>This button will open a pop-up. Here you can select the branch to run the Action from, and if you <a href=#manually-selecting-projects rel>added any inputs</a>, you can type in the values. Once happy, press a green &ldquo;<em>Run workflow</em>&rdquo; button on the bottom.<figure><a class=lightgallery href=/blog/nuget-github-actions/screenshot-running-action-2.png title=/blog/nuget-github-actions/screenshot-running-action-2.png data-thumbnail=/blog/nuget-github-actions/screenshot-running-action-2.png data-sub-html="<h2>Action inputs</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=screenshot-running-action-2.png data-srcset="/blog/nuget-github-actions/screenshot-running-action-2.png, screenshot-running-action-2.png 1.5x, /blog/nuget-github-actions/screenshot-running-action-2.png 2x" data-sizes=auto alt=/blog/nuget-github-actions/screenshot-running-action-2.png></a><figcaption class=image-caption>Action inputs</figcaption></figure></p><p>After a short moment, a workflow run should appear on the list. You can click its name and then big button with job name to view the progress.
<a class=lightgallery href=/blog/nuget-github-actions/screenshot-running-action-3.png title=/blog/nuget-github-actions/screenshot-running-action-3.png data-thumbnail=/blog/nuget-github-actions/screenshot-running-action-3.png><img class=lazyload src=/svg/loading.min.svg data-src=screenshot-running-action-3.png data-srcset="/blog/nuget-github-actions/screenshot-running-action-3.png, screenshot-running-action-3.png 1.5x, /blog/nuget-github-actions/screenshot-running-action-3.png 2x" data-sizes=auto alt=/blog/nuget-github-actions/screenshot-running-action-3.png></a><figure><a class=lightgallery href=/blog/nuget-github-actions/screenshot-running-action-4.png title=/blog/nuget-github-actions/screenshot-running-action-4.png data-thumbnail=/blog/nuget-github-actions/screenshot-running-action-4.png data-sub-html="<h2>Action progress screen - as you can see, I set publishing of MyLibrary.ExtraStuff to &lsquo;N&rsquo;, so it was skipped</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=screenshot-running-action-4.png data-srcset="/blog/nuget-github-actions/screenshot-running-action-4.png, screenshot-running-action-4.png 1.5x, /blog/nuget-github-actions/screenshot-running-action-4.png 2x" data-sizes=auto alt=/blog/nuget-github-actions/screenshot-running-action-4.png></a><figcaption class=image-caption>Action progress screen - as you can see, I set publishing of <em>MyLibrary.ExtraStuff</em> to &lsquo;N&rsquo;, so it was skipped</figcaption></figure></p><p>Once the Action finishes executing, your package should appear on the NuGet repository of your choice!</p><h2 id=summary>Summary</h2><p>Congratulations! You now know how to automate your NuGet package publishing with GitHub Actions!</p><p>Granted, it still requires a button press (unless you choose a different trigger, but I personally wouldn&rsquo;t), but this is just a button press instead of series of terminal commands. I personally created this Action for my library <a href=https://wolfringo.tehgm.net target=_blank rel="noopener noreffer">Wolfringo</a>, which is a set of 6 NuGet packages - this GitHub Action makes publishing of new versions much much less tedious!</p><div class="details admonition example open"><div class="details-summary admonition-title"><i class="icon fas fa-list-ol fa-fw"></i>Example<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>You can check out the Action I built for Wolfringo on GitHub: <a href=https://github.com/TehGM/Wolfringo/blob/master/.github/workflows/nuget-publish.yml>https://github.com/TehGM/Wolfringo/blob/master/.github/workflows/nuget-publish.yml</a></div></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 09.01.2021</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://tehgm.net/blog/nuget-github-actions/ data-title="Publishing NuGet packages with GitHub Actions" data-via=TehOriginalGM data-hashtags=guide,dev><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://tehgm.net/blog/nuget-github-actions/ data-hashtag=guide><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="Share on WhatsApp" data-sharer=whatsapp data-url=https://tehgm.net/blog/nuget-github-actions/ data-title="Publishing NuGet packages with GitHub Actions" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href=javascript:void(0); title="Share on Tumblr" data-sharer=tumblr data-url=https://tehgm.net/blog/nuget-github-actions/ data-title="Publishing NuGet packages with GitHub Actions" data-caption="It's time to stop publishing NuGet packages manually - learn how to automate NuGet packages publishing with GitHub Actions!" data-tags=guide,dev><i class="fab fa-tumblr fa-fw"></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://tehgm.net/blog/nuget-github-actions/ data-title="Publishing NuGet packages with GitHub Actions"><i class="fab fa-hacker-news fa-fw"></i></a><a href=javascript:void(0); title="Share on Reddit" data-sharer=reddit data-url=https://tehgm.net/blog/nuget-github-actions/><i class="fab fa-reddit fa-fw"></i></a><a href=javascript:void(0); title="Share on Myspace" data-sharer=myspace data-url=https://tehgm.net/blog/nuget-github-actions/ data-title="Publishing NuGet packages with GitHub Actions" data-description="It's time to stop publishing NuGet packages manually - learn how to automate NuGet packages publishing with GitHub Actions!"><i data-svg-src=/lib/simple-icons/icons/myspace.min.svg></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/blog/tags/guide/>guide</a>,&nbsp;<a href=/blog/tags/dev/>dev</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/blog/docfx-github-actions/ class=prev rel=prev title="DocFX automation with GitHub Actions"><i class="fas fa-angle-left fa-fw"></i>DocFX automation with GitHub Actions</a>
<a href=/blog/aspnetcore-sass-js-minify/ class=next rel=next title="Compiling SASS and minifying JS and CSS with ASP.NET Core">Compiling SASS and minifying JS and CSS with ASP.NET Core<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2020 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://tehgm.net>TehGM</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=/lib/lightgallery/lightgallery.min.css><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-thumbnail.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/typeit/typeit.min.js></script><script type=text/javascript src=https://code.jquery.com/jquery-3.5.1.min.js></script><script type=text/javascript src=/js/spoiler.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{},"data":{"id-1":"TehGM","id-2":"TehGM"},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"typeit":{"cursorChar":null,"cursorSpeed":null,"data":{"id-1":["id-1"],"id-2":["id-2"]},"duration":null,"speed":null}};</script><script type=text/javascript src=/js/theme.min.js></script></body></html>